<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Pokemon AR</title>

    <!-- A-Frame + AR.js -->
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>
    <link href="https://fonts.cdnfonts.com/css/pokemon-solid" rel="stylesheet">

</head>
<body style="margin:0; overflow:hidden;">

<a-scene embedded arjs>
    <!-- Caméra + curseur souris pour cliquer sur les entités .clickable -->
    <a-entity id="cameraRig">
        <a-entity id="camera" camera position="0 0 0"></a-entity>
        <a-entity cursor="fuse:false; rayOrigin: mouse;"
                  raycaster="objects: .clickable"></a-entity>
    </a-entity>

    <!-- PIKACHU -->
    <a-marker type="pattern"
              url="./marker/pattern-pikachu.patt"
              id="pikaPattern"
              emitevents="true">
        <!-- Le modèle est cliquable -->
        <a-entity id="pika"
                  class="clickable"
                  gltf-model="url(./asset/pikachu.glb)"
                  scale="0.015 0.015 0.015"
                  position="0 0 0">
        </a-entity>

        <!-- Bulle d'information (cachée par défaut) -->
        <a-entity id="pikaInfo" visible="false" position="0.7 0.7 0" look-at="#camera">
            <a-entity id="pikaSound"
                      sound="src: url(./sounds/pikachuSound.mp3);
                     autoplay: false;
                     loop: false;
                     positional: false;
                     volume: 0.9">
            </a-entity>
            <!-- Panneau de fond semi-opaque pour lisibilité -->

            <a-plane width="0.36" height="0.22" material="color: #111; opacity: 0.8"></a-plane>

            <!-- Petit triangle 'pointe' vers le Pokémon -->
            <a-triangle position="-0.20 -0.07 0.001"
                        vertex-a="0 0 0"
                        vertex-b="0.06 0.04 0"
                        vertex-c="0.06 -0.04 0"
                        material="color: #111; opacity: 0.8"></a-triangle>

            <!-- Texte (nom, type, PV) en blanc, aligné à gauche -->
            <a-entity position="-0.4 0.002 0.002">
                <a-text
                        value="Nom: Pikachu\nType: Electrik\nPV: 35/35"
                        rotation="0 0 0"
                        color="#FFF"
                        font-family="Pokemon Solid"
                        width="2"
                        shader="msdf">
                </a-text>
            </a-entity>

        </a-entity>
    </a-marker>

    <!-- MEW -->
    <a-marker type="pattern"
              url="./marker/pattern-mew.patt"
              id="mewPattern"
              emitevents="true">
        <!-- Le modèle est cliquable -->
        <a-entity
                gltf-model="url(./asset/mew.glb)"
                scale="0.03 0.03 0.03"
                class="clickable"
                id="mew"
                position="0 0 0">
        </a-entity>

        <!-- Bulle d'information (cachée par défaut) -->
        <a-entity id="mewInfo" visible="false" position="0.3 0.12 0" look-at="#camera">
            <a-entity id="mewSound"
                      sound="src: url(./sounds/mewSound.mp3);
                     autoplay: false;
                     loop: false;
                     positional: false;
                     volume: 0.9">
            </a-entity>
            <!-- Panneau de fond semi-opaque pour lisibilité -->
            <a-plane width="0.36" height="0.22" material="color: #111; opacity: 0.8"></a-plane>

            <!-- Petit triangle 'pointe' vers le Pokémon -->
            <a-triangle position="-0.20 -0.07 0.001"
                        vertex-a="0 0 0"
                        vertex-b="0.06 0.04 0"
                        vertex-c="0.06 -0.04 0"
                        material="color: #111; opacity: 0.8"></a-triangle>

            <!-- Texte (nom, type, PV) en blanc, aligné à gauche -->
            <a-entity position="-0.4 0.002 0.002">
                <a-text
                        value="Nom: Mew\nType: Psy\nPV: 35/35"
                        rotation="0 0 0"
                        color="#FFF"
                        font-family="Pokemon Solid"
                        width="2"
                        shader="msdf">
                </a-text>
            </a-entity>
        </a-entity>
    </a-marker>

    <!-- LUXRAY -->
    <a-marker type="pattern"
              url="./marker/pattern-luxray.patt"
              id="luxrayPattern"
              emitevents="true">
        <a-entity
                gltf-model="url(./asset/pakemon_luxray.glb)"
                scale="1 1 1"
                id="luxray"
                class="clickable"
                position="0 0 0">
        </a-entity>
        <!-- Bulle d'information (cachée par défaut) -->
        <a-entity id="luxrayInfo" visible="false" position="0.3 0.12 0" look-at="#camera">
            <a-entity id="luxraySound"
                      sound="src: url(./sounds/luxraySound.mp3);
                     autoplay: false;
                     loop: false;
                     positional: false;
                     volume: 0.9">
            </a-entity>
            <!-- Panneau de fond semi-opaque pour lisibilité -->
            <a-plane width="0.36" height="0.22" material="color: #111; opacity: 0.8"></a-plane>

            <!-- Petit triangle 'pointe' vers le Pokémon -->
            <a-triangle position="-0.20 -0.07 0.001"
                        vertex-a="0 0 0"
                        vertex-b="0.06 0.04 0"
                        vertex-c="0.06 -0.04 0"
                        material="color: #111; opacity: 0.8"></a-triangle>

            <!-- Texte (nom, type, PV) en blanc, aligné à gauche -->
            <a-entity position="-0.6 0.002 0.002">
                <a-text
                        value="Nom: Luxray\nType: Electrik\nPV: 35/35"
                        rotation="0 0 0"
                        color="#FFF"
                        font-family="Pokemon Solid"
                        width="2"
                        shader="msdf">
                </a-text>
            </a-entity>
        </a-entity>
    </a-marker>

    <!-- ECTOPLASMA -->
    <a-marker preset="hiro" id="hiroPattern">
        <a-entity
                gltf-model="url(./asset/ectoplasma.glb)"
                scale="0.017 0.017 0.017"
                id="ectoplasma"
                class="clickable"
                position="0 0 0">
        </a-entity>
        <!-- Bulle d'information (cachée par défaut) -->
        <a-entity id="ectoplasmaInfo" visible="false" position="0.3 0.12 0" look-at="#camera">
            <a-entity id="ectoplasmaSound"
                      sound="src: url(./sounds/ectoplasmaSound.mp3);
                     autoplay: false;
                     loop: false;
                     positional: false;
                     volume: 0.9">
            </a-entity>
            <!-- Panneau de fond semi-opaque pour lisibilité -->
            <a-plane width="0.36" height="0.22" material="color: #111; opacity: 0.8"></a-plane>

            <!-- Petit triangle 'pointe' vers le Pokémon -->
            <a-triangle position="-0.20 -0.07 0.001"
                        vertex-a="0 0 0"
                        vertex-b="0.06 0.04 0"
                        vertex-c="0.06 -0.04 0"
                        material="color: #111; opacity: 0.8"></a-triangle>

            <!-- Texte (nom, type, PV) en blanc, aligné à gauche -->
            <a-entity position="-0.6 0.002 0.002">
                <a-text
                        value="Nom: Ectoplasma\nType: Spectre\nPV: 35/35"
                        rotation="0 0 0"
                        color="#FFF"
                        font-family="Pokemon Solid"
                        width="2"
                        shader="msdf">
                </a-text>
            </a-entity>
        </a-entity>
    </a-marker>
</a-scene>

<script>
    // --- Sélecteurs
    const mew = document.getElementById('mew');
    const mewInfo = document.getElementById('mewInfo');
    const mewMarker = document.getElementById('mewPattern');
    const mewSound = document.getElementById('mewSound');

    // --- Toggle bulle au clic sur le modèle
    mew.addEventListener('click', () => {
        mewInfo.setAttribute('visible', !mewInfo.getAttribute('visible'));
    });

    // --- Fermer la bulle quand on perd le marqueur (évite de "garder" une bulle à l'écran)
    mewMarker.addEventListener('markerLost', () => {
        mewInfo.setAttribute('visible', false);
    });

    // --- son
    mewMarker.addEventListener('markerFound', () => mewSound.components.sound.playSound());
    mewMarker.addEventListener('markerLost',  () => mewSound.components.sound.stopSound());

    const luxray = document.getElementById('luxray');
    const luxrayInfo = document.getElementById('luxrayInfo');
    const luxrayMarker = document.getElementById('luxrayPattern');
    const luxraySound = document.getElementById('luxraySound');


    // --- Toggle bulle au clic sur le modèle
    luxray.addEventListener('click', () => {
        luxrayInfo.setAttribute('visible', !luxrayInfo.getAttribute('visible'));
    });

    // --- Fermer la bulle quand on perd le marqueur (évite de "garder" une bulle à l'écran)
    luxrayMarker.addEventListener('markerLost', () => {
        luxrayInfo.setAttribute('visible', false);
    });

    // --- son
    luxrayMarker.addEventListener('markerFound', () => luxraySound.components.sound.playSound());
    luxrayMarker.addEventListener('markerLost',  () => luxraySound.components.sound.stopSound());

    const pika = document.getElementById('pika');
    const pikaInfo = document.getElementById('pikaInfo');
    const pikaMarker = document.getElementById('pikaPattern');
    const pikaSound = document.getElementById('pikaSound');

    // --- Toggle bulle au clic sur le modèle
    pika.addEventListener('click', () => {
        pikaInfo.setAttribute('visible', !pikaInfo.getAttribute('visible'));
    });

    // --- Fermer la bulle quand on perd le marqueur (évite de "garder" une bulle à l'écran)
    pikaMarker.addEventListener('markerLost', () => {
        pikaInfo.setAttribute('visible', false);
    });

    // --- son
    pikaMarker.addEventListener('markerFound', () => pikaSound.components.sound.playSound());
    pikaMarker.addEventListener('markerLost',  () => pikaSound.components.sound.stopSound());

    const ecto = document.getElementById('ectoplasma');
    const ectoInfo = document.getElementById('ectoplasmaInfo');
    const ectoMarker = document.getElementById('hiroPattern');
    const ectoSound = document.getElementById('ectoplasmaSound');

    // --- Toggle bulle au clic sur le modèle
    ecto.addEventListener('click', () => {
        ectoInfo.setAttribute('visible', !ectoInfo.getAttribute('visible'));
    });

    // --- Fermer la bulle quand on perd le marqueur (évite de "garder" une bulle à l'écran)
    ectoMarker.addEventListener('markerLost', () => {
        ectoInfo.setAttribute('visible', false);
    });

    // --- son
    ectoMarker.addEventListener('markerFound', () => ectoSound.components.sound.playSound());
    ectoMarker.addEventListener('markerLost',  () => ectoSound.components.sound.stopSound());

    // ===== Déverrouillage audio (mobile/web autoplay) =====
    const unmuteBtn = document.getElementById('unmute');
    unmuteBtn.addEventListener('click', async () => {
        try {
            const scene = document.querySelector('a-scene');
            // différents chemins selon versions d'A-Frame
            const ctx = (scene.systems && scene.systems.sound && scene.systems.sound.context) ||
                (AFRAME.audioContext);
            if (ctx && ctx.state !== 'running') {
                await ctx.resume();
            }
            // petit “ping” silencieux pour initialiser (optionnel)
            [pikaSound, mewSound, luxraySound].forEach(e => {
                if (e.components.sound && e.components.sound.pool.children.length === 0) {
                    // force la création du buffer en jouant/stop instantanément
                    e.components.sound.playSound();
                    e.components.sound.stopSound();
                }
            });
            unmuteBtn.classList.add('hidden');
        } catch (e) {
            console.warn('Impossible de déverrouiller l’audio:', e);
        }
    });

</script>
</body>
</html>